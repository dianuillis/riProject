<?xml version="1.0" encoding="UTF-8"?>
<!-- generated by CLiX/Wiki2XML [MPI-Inf, MMCI@UdS] $LastChangedRevision: 92 $ on 16.04.2009 16:53:51[mciao0826] -->
<!DOCTYPE article SYSTEM "../article.dtd">
<article xmlns:xlink="http://www.w3.org/1999/xlink">
<header>
<title>Defragmentation</title>
<id>360339</id>
<revision>
<id>244685734</id>
<timestamp>2008-10-12T01:20:18Z</timestamp>
<contributor>
<username>Ttony21</username>
<id>4044380</id>
</contributor>
</revision>
<categories>
<category>File system management</category>
<category>Articles to be merged since September 2008</category>
<category>All articles to be merged</category>
<category>Defragmentation software</category>
</categories>
</header>
<bdy>

"Defrag" redirects here. For other uses, see <link xlink:type="simple" xlink:href="../292/16547292.xml">
Defrag (disambiguation)</link>.
"Disk Defragmenter" redirects here. For the Microsoft Windows utility, see <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../293/6709293.xml">
Disk Defragmenter (Windows)</link></software>
.<p>

In the context of administering <link xlink:type="simple" xlink:href="../457/7878457.xml">
computer system</link>s, <b>defragmentation</b> is a process that reduces the amount of <link xlink:type="simple" xlink:href="../119/8429119.xml">
fragmentation</link> in <link xlink:type="simple" xlink:href="../280/1010280.xml">
file system</link>s. It does this by physically reorganizing the contents of the disk to store the pieces of each <link xlink:type="simple" xlink:href="../077/7077.xml">
file</link> close together and <link xlink:type="simple" xlink:href="../636/3103636.xml#xpointer(//*[./st=%22Computer+Science%22])">
contiguously</link>. It also attempts to create larger regions of free space using <it>compaction</it> to impede the return of fragmentation. Some defragmenters also try to keep smaller files within a single directory together, as they are often accessed in sequence.</p>

<sec>
<st>
Causes of fragmentation</st>

<p>

<table class="metadata plainlinks ambox ">
<row>
<col>

ambox-move" style=""</col>
</row>
<row>
<col class="mbox-image"><p>

<image width="50px" src="Merge-arrow.svg">
<caption>

Merge arrow
</caption>
</image>
</p>
</col>
<col style="" class="mbox-text">
 It has been suggested that this article or section be  into . ()</col>
</row>
</table>


Fragmentation occurs when the operating system cannot or will not allocate enough contiguous space to store a complete file as a unit, but instead puts parts of it in gaps between other files (usually those gaps exist because they formerly held a file that the operating system has subsequently deleted or because the operating system allocated excess space for the file in the first place).  Larger files and greater numbers of files also contribute to fragmentation and consequent performance loss. Defragmentation attempts to alleviate these problems.</p>
<p>

<list>
<entry level="1" type="definition">

Example</entry>
</list>

Consider the following scenario, as shown by the image on the right:</p>
<p>

<image location="right" width="410px" src="File_system_fragmentation.svg">
</image>

An otherwise blank disk has 5 files, A, B, C, D and E each using 10 blocks of space (for this section, a <it>block</it> is an allocation unit of that system, it could be 1K, 100K or 1 megabyte and is not any specific size).  On a blank disk, all of these files will be allocated one after the other. (Example (1) on the image.)  If file B is deleted, there are two options, leave the space for B empty and use it again later, or compress all the files after B so that the empty space follows it.  This could be time consuming if there were hundreds or thousands of files which needed to be moved, so in general the empty space is simply left there, marked in a table as available for later use, then used again as needed.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%221%22])">1</ref> (Example (2) on the image.)  Now, if a new file, F, is allocated 7 blocks of space, it can be placed into the first 7 blocks of the space formerly holding the file B and the 3 blocks following it will remain available. (Example (3) on the image.)  If another new file, G is added, and needs only three blocks, it could then occupy the space after F and before C. (Example (4) on the image).  Now, if subsequently F needs to be expanded, since the space immediately following it is no longer available, there are two options: (1) add a new block somewhere else and indicate that F has a second <it>extent</it>, or (2) move the file F to someplace else where it can be created as one contiguous file of the new, larger size.  The latter operation may not be possible as the file may be larger than any one contiguous space available, or the file conceivably could be so large the operation would take an undesirably long period of time, thus the usual practice is simply to create an <it>extent</it> somewhere else and chain the new extent onto the old one. (Example (5) on the image.)  Repeat this practice hundreds or thousands of times and eventually the file system has many free segments in many places and many files may be spread over many extents.  If, as a result of free space fragmentation, a newly created file (or a file which has been extended) has to be placed in a large number of extents, access time for that file (or for all files) may become excessively long.</p>
<p>

The process of creating new files, and of deleting and expanding existing files, may sometimes be colloquially referred to as <it>churn</it>, and can occur at both the level of the general root file system and in <link xlink:type="simple" xlink:href="../027/5515027.xml">
subdirectories</link>.  Fragmentation not only occurs at the level of individual files, but also when different files in a directory (and maybe its subdirectories), that are often read in a sequence, start to "drift apart" as a result of "churn".</p>
<p>

A defragmentation program must move files around within the free space available to undo fragmentation.  This is a memory intensive operation and cannot be performed on a file system with no free space.  The reorganization involved in defragmentation does not change logical location of the files (defined as their location within the <link xlink:type="simple" xlink:href="../027/5515027.xml">
directory</link> structure).</p>

</sec>
<sec>
<st>
Common countermeasures</st>
<p>

<list>
<entry level="1" type="definition">

Partitioning</entry>
</list>

A common strategy to optimize defragmentation and to reduce the impact of fragmentation is to partition the hard disk(s) in a way that separates partitions of the file system that experience many more reads than writes from the more volatile zones where files are created and deleted frequently.  In <link xlink:type="simple" xlink:href="../890/18890.xml">
Microsoft Windows</link>, the contents of directories such as "\Program Files"  or "\Windows" are modified far less frequently than they are read.  The directories that contain the users' profiles are modified constantly (especially with the Temp directory and Internet Explorer cache creating thousands of files that are deleted in a few days).  If files from user profiles are held on a dedicated partition (as is commonly done on <link xlink:type="simple" xlink:href="../642/31642.xml">
UNIX</link> systems), the defragmenter runs better since it does not need to deal with all the static files from other directories.  For partitions with relatively little write activity, defragmentation performance greatly improves after the first defragmentation, since the defragmenter will need to defrag only a small number of new files in the future.</p>

</sec>
<sec>
<st>
Problems</st>

<ss1>
<st>
 Immovable files </st>
<p>

The presence of immovable system files, especially a <link xlink:type="simple" xlink:href="../193/311193.xml">
swap file</link>, can impede defragmentation.  These files can be safely moved when the operating system is not in use.  For example, <link xlink:type="simple" xlink:href="../862/2118862.xml">
ntfsresize</link> moves these files to resize an <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../184/39184.xml">
NTFS</link></instrumentality>
</artifact>
</system>
 partition, and the tool <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../385/1555385.xml">
PageDefrag</link></software>
 can defragment Windows system files such as the <link xlink:type="simple" xlink:href="../193/311193.xml">
swap file</link> and the files that store the <link xlink:type="simple" xlink:href="../933/1164933.xml">
Windows registry</link> by running at boot time before the GUI is loaded. If the NTFS Master File Table must grow after the partition was formatted, fragmentation of the MFT can occur, and it cannot be safely defragmented while the partition is in use; only some defragmentation programs, such as <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../184/2396184.xml">
Diskeeper</link></software>
, are capable of defragmenting the MFT.</p>

</ss1>
<ss1>
<st>
 Fragmentation buildup </st>
<p>

On systems without fragmentation resistance, fragmentation builds upon itself when left unhandled, so periodic defragmentation is necessary to keep the disk performance at peak and avoid the excess overhead of less frequent defragmentation.</p>

</ss1>
</sec>
<sec>
<st>
User and performance issues</st>
<p>

In a wide range of modern multi-user operating systems, an ordinary user cannot defragment the system disks since superuser (or "Administrator") access is required to move system files. Additionally, file systems such as <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../184/39184.xml">
NTFS</link></instrumentality>
</artifact>
</system>
 (and most <family wordnetid="108078020" confidence="0.8">
<link xlink:type="simple" xlink:href="../642/31642.xml">
Unix</link></family>
/<O wordnetid="106832680" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../297/6097297.xml">
Linux</link></O>
 filesystems) are designed to decrease the likelihood of fragmentation.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%222%22])">2</ref><ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%223%22])">3</ref> Improvements in modern hard drives such as RAM cache, faster platter rotation speed, and greater data density reduce the negative impact of fragmentation on system performance to some degree, though increases in commonly used data quantities offset those benefits. However, modern systems profit enormously from the huge disk capacities currently available, since partially filled disks fragment much less than full disks.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%224%22])">4</ref>.</p>

</sec>
<sec>
<st>
Approach and defragmenters by file system type</st>
<p>

<list>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../045/53045.xml">
FAT</link>: DOS 6.x and Windows 9x-systems come with a defragmentation utility called Defrag. The DOS version is a limited version of Norton SpeedDisk<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%225%22])">5</ref>, and the Windows version is licensed from <company wordnetid="108058098" confidence="0.8">
<institution wordnetid="108053576" confidence="0.8">
<link xlink:type="simple" xlink:href="../200/10903200.xml">
Diskeeper Corporation</link></institution>
</company>
.</entry>
<entry level="1" type="bullet">

 <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../184/39184.xml">
NTFS</link></instrumentality>
</artifact>
</system>
: Windows 2000 and newer include a <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../293/6709293.xml">
defragmentation tool</link></software>
 based on <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../184/2396184.xml">
Diskeeper</link></software>
. NT 4 and below do not have built-in defragmentation utilities. Unfortunately, in some cases the integrated defragger does not consolidate free space very well (particularly on the system, or "OS," drive). Thus, a heavily fragmented drive with many small files may still not have much contiguous, free space after defragmentation. So any new large file will instantly be split into small fragments with immediate impact on performance. This can happen even if the overall disk usage is less than 60%<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%226%22])">6</ref>, but especially if the disk is rather full. It often helps to repeat defragmentation, even several times, to enhance the results. Comparing the Before and After displays each time will indicate the degree of improvement. In cases where the disk's initial free space is low, it will enhance defragmentation if large files can be moved to another partition or drive (or simply deleted, if not wanted) before defragmenting. This provides more available workspace for the defragmenter to use while running. A system drive will defragment better if it can be slaved into another computer (or if its computer can be booted from another medium), since its system files would, therefore, not be in use and free to move.</entry>
</list>
</p>
<p>

<list>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../194/39194.xml">
ext2</link> (Linux) uses an offline defragmenter called e2defrag, which does not work with its successor <link xlink:type="simple" xlink:href="../195/39195.xml">
ext3</link>. Instead, a filesystem-independent defragmenter like Shake<weblink xlink:type="simple" xlink:href="http://vleu.net/shake/">
http://vleu.net/shake/</weblink> may be used.</entry>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../266/1514266.xml">
vxfs</link> has <link>
fsadm</link> utility meant to perform also defrag operations.</entry>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../487/50487.xml">
JFS</link> has a <link>
defragfs</link><weblink xlink:type="simple" xlink:href="http://www.ecomstation.com/support/index.phtml?url=content/support-faq-jfs.html&amp;title=Journaling%20%20File%20System">
http://www.ecomstation.com/support/index.phtml?url=content/support-faq-jfs.html&amp;title=Journaling%20%20File%20System</weblink> utility on IBM operating systems.</entry>
<entry level="1" type="bullet">

 <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../752/927752.xml">
HFS Plus</link></instrumentality>
</artifact>
</system>
 (Mac OS X) In 1998 it introduced a number of optimizations to the allocation algorithms in an attempt to defragment files while they are being accessed without a separate defragmenter. If the filesystem does become fragmented, the only way to do it is to purchase a defragmenting utility, such as Coriolis System's iDefrag.</entry>
<entry level="1" type="bullet">

 <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../858/1247858.xml">
WAFL</link></instrumentality>
</artifact>
</system>
 in <company wordnetid="108058098" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../623/855623.xml">
NetApp</link></company>
's ONTAP 7.2 operating system has a command called reallocate that is designed to defragment large files.</entry>
<entry level="1" type="bullet">

 <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../203/34203.xml">
XFS</link></instrumentality>
</artifact>
</system>
 Provides an online defragmentation utility called xfs_fsr.</entry>
<entry level="1" type="bullet">

 <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../421/1010421.xml">
SFS</link></instrumentality>
</artifact>
</system>
  Processes the defragmentation feature in almost completely stateless way (apart from the location it is working on), so defragmentation can be stopped and started instantly.</entry>
</list>
</p>

</sec>
<sec>
<st>
See also</st>
<p>

<list>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../369/3909369.xml">
Fragmentation</link></entry>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../119/8429119.xml">
File system fragmentation</link></entry>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../993/14088993.xml">
List of defragmentation software</link></entry>
<entry level="1" type="bullet">

 <link xlink:type="simple" xlink:href="../078/2850078.xml">
Optimization software</link></entry>
</list>
</p>

</sec>
<sec>
<st>
References</st>

<p>

<reflist>
<entry id="1">
The practice of leaving the empty space behind after a file is deleted, marked in a table as available for later use, then used again as needed is why <link xlink:type="simple" xlink:href="../265/2079265.xml">
undelete</link> programs were able to work, they simply recovered the file whose name had been deleted from the directory, but the contents were still on disk.</entry>
<entry id="2">
<weblink xlink:type="simple" xlink:href="http://searchwincomputing.techtarget.com/tip/0,289483,sid68_gci1215568,00.html">
NTFS decreases the likelihood of fragmentation as compared to older filesystems</weblink></entry>
<entry id="3">
<weblink xlink:type="simple" xlink:href="http://pl.atyp.us/wordpress/?p=241">
UNIX filesystems tend to do a lot to prevent fragmentation</weblink></entry>
<entry id="4">
<weblink xlink:type="simple" xlink:href="http://searchwincomputing.techtarget.com/tip/0,289483,sid68_gci1216336,00.html">
Modern hard drive improvements minimize negative impact of fragmentation</weblink></entry>
<entry id="5">
<it>Peter Norton's Complete Guide to DOS 6.22</it>, page 521</entry>
<entry id="6">
See <it>Windows XP Timesaving Techniques For Dummies, Second Edition</it> page 456.</entry>
</reflist>
</p>

</sec>
<sec>
<st>
Sources</st>
<p>

<list>
<entry level="1" type="bullet">

 Norton, Peter (1994) <it>Peter Norton's Complete Guide to DOS 6.22</it>, page 521 - Sams (ISBN 067230614X)</entry>
<entry level="1" type="bullet">

 Woody Leonhard, Justin Leonhard (2005) <it>Windows XP Timesaving Techniques For Dummies, Second Edition</it> page 456 - For Dummies (ISBN 0-764578-839).</entry>
<entry level="1" type="bullet">

 Jensen, Craig (1994). <it>Fragmentation: The Condition, the Cause, the Cure</it>.  Executive Software International (ISBN 0-9640049-0-9).</entry>
<entry level="1" type="bullet">

 <celebrity wordnetid="109903153" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../344/5281344.xml">
Dave Kleiman</link></celebrity>
, Laura Hunter, Mahesh Satyanarayana, Kimon Andreou, Nancy G Altholz, Lawrence Abrams, Darren Windham, Tony Bradley and Brian Barber (2006) <it>Winternals: Defragmentation, Recovery, and Administration Field Guide</it> - Syngress (ISBN 1-597490-792)</entry>
<entry level="1" type="bullet">

 Robb, Drew (2003) <it>Server Disk Management in a Windows Environment</it> Chapter 7 - AUERBACH (ISBN 0849324327)</entry>
</list>
</p>

</sec>
<sec>
<st>
External links</st>
<p>

<list>
<entry level="1" type="bullet">

 <weblink xlink:type="simple" xlink:href="http://www.microsoft.com/windowsxp/using/setup/tips/defrag.mspx">
Microsoft Windows XP defragmentation - How to schedule a weekly defragmentation</weblink> </entry>
<entry level="1" type="bullet">

 <weblink xlink:type="simple" xlink:href="http://windowsitpro.com/article/articleid/77564/jsi-tip-6260-startdefrag-will-schedule-a-windows-2000-defrag-and-it-is-free-for-personal-use.html">
Microsoft Windows 2000 Professional and Server defragmentation - How to schedule defragmentation</weblink></entry>
</list>
</p>


</sec>
</bdy>
</article>
