<?xml version="1.0" encoding="UTF-8"?>
<!-- generated by CLiX/Wiki2XML [MPI-Inf, MMCI@UdS] $LastChangedRevision: 92 $ on 16.04.2009 17:47:16[mciao0828] -->
<!DOCTYPE article SYSTEM "../article.dtd">
<article xmlns:xlink="http://www.w3.org/1999/xlink">
<header>
<title>Macintosh Toolbox</title>
<id>861398</id>
<revision>
<id>230885401</id>
<timestamp>2008-08-09T21:25:14Z</timestamp>
<contributor>
<username>DumZiBoT</username>
<id>6085301</id>
</contributor>
</revision>
<categories>
<category>Macintosh firmware</category>
<category>Mac OS</category>
</categories>
</header>
<bdy>

The <b><link xlink:type="simple" xlink:href="../979/19006979.xml">
Macintosh</link> Toolbox</b> is a set of <link xlink:type="simple" xlink:href="../ury/24th_century.xml">
application programming interface</link>s with a particular access mechanism. They implement many of the high-level features of the <link xlink:type="simple" xlink:href="../043/20043.xml">
Mac OS</link>. The Toolbox is comprised of a number of "managers," software components such as <link xlink:type="simple" xlink:href="../439/256439.xml">
QuickDraw</link>, responsible for drawing onscreen graphics, and the Menu Manager, which maintain data structures describing the menu bar. As the Macintosh was designed without <link xlink:type="simple" xlink:href="../354/32354.xml">
virtual memory</link> or <link xlink:type="simple" xlink:href="../373/515373.xml">
memory protection</link>, it was important to classify code according to when it should be loaded into memory or kept on disk, and how it should be accessed. The Toolbox consists of subroutines essential enough to be permanently kept in memory and accessible by a two-byte <link xlink:type="simple" xlink:href="../772/47772.xml">
machine instruction</link>; however it excludes core "kernel" functionality such as <link xlink:type="simple" xlink:href="../924/66924.xml">
memory management</link> and the <link xlink:type="simple" xlink:href="../280/1010280.xml">
file system</link>. Note that the Toolbox does not <it>draw</it> the menu onscreen: menus were designed to have a customizable appearance, so the drawing code was stored in a <link xlink:type="simple" xlink:href="../655/146655.xml">
resource</link>, which could be on a disk.
<sec>
<st>
 Advent and implementation </st>

<p>

The original, <chip wordnetid="103020034" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<microprocessor wordnetid="103760310" confidence="0.8">
<conductor wordnetid="103088707" confidence="0.8">
<device wordnetid="103183080" confidence="0.8">
<semiconductor_device wordnetid="104171831" confidence="0.8">
<link xlink:type="simple" xlink:href="../826/64826.xml">
Motorola 68000 family</link></semiconductor_device>
</device>
</conductor>
</microprocessor>
</instrumentality>
</artifact>
</chip>
, implementation of the Macintosh operating system implements <link>
system calls</link> using that processor's <link xlink:type="simple" xlink:href="../469/3956469.xml">
illegal opcode</link> <link xlink:type="simple" xlink:href="../289/15289.xml">
exception handling</link> mechanism. Motorola specified that instructions beginning with <it>1111</it> and <it>1010</it> would never be used in future 68000 family processors, thus freeing them for use such as by an operating system. As <it>1111</it> was reserved for use by <it>co</it>-processors such as the <link xlink:type="simple" xlink:href="../803/1830803.xml">
68881</link> <link xlink:type="simple" xlink:href="../see/Linden=2C_T$ennessee.xml">
FPU</link>, Apple chose <it>1010</it>, or the <link xlink:type="simple" xlink:href="../151/208151.xml">
number ten</link>, as the prefix for operating system calls. Ten is represented in <link xlink:type="simple" xlink:href="../263/13263.xml">
hexadecimal</link> as <it>A</it>, and handling illegal instructions is known as <it>trapping</it>, so these special instructions were called <it>A-traps</it>.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%221%22])">1</ref> When the processor encounters such an instruction, it transfers control to the operating system, which looks up and performs the appropriate task. There were two advantages to this mechanism:</p>
<p>

<list>
<entry level="1" type="bullet">

 It results in compact programs. Only two <link xlink:type="simple" xlink:href="../365/3365.xml">
byte</link>s are taken by every operating system access, in contrast to four or six when using regular <link xlink:type="simple" xlink:href="../210/1013210.xml">
jump instruction</link>s.</entry>
<entry level="1" type="bullet">

 The table used to look up the appropriate function is stored in RAM. Then, even if the underlying code was stored in ROM, it could still be overridden (<it><link xlink:type="simple" xlink:href="../153/475153.xml">
patched</link></it>) by replacing the ROM <link xlink:type="simple" xlink:href="../018/568018.xml">
memory address</link> with a RAM address.</entry>
</list>
</p>
<p>

The system was further optimized by allotting some bits of the A-trap instruction to store <idea wordnetid="105833840" confidence="0.8">
<concept wordnetid="105835747" confidence="0.8">
<link xlink:type="simple" xlink:href="../375/324375.xml">
parameter</link></concept>
</idea>
s to the most common functions. For example, <link xlink:type="simple" xlink:href="../117/547117.xml">
memory allocation</link> is a very common task, so it should be expressed in as few bytes of code as possible. Sometimes the programmer wants to clear the memory block to zeros, so either the allocation function should take a binary parameter, or there should be two allocation functions. To pass a parameter would require an additional two-byte instruction, which would be inefficient. Having two functions would require at least an extra four bytes of RAM used for the address in the function look-up table. The most efficient solution is to map multiple A-traps to the same subroutine, which then uses the A-trap as a parameter. This is true of the most commonly used subroutines. However, the Toolbox was composed of the <it>less</it> commonly used subroutines. The Toolbox was defined as the set of subroutines which took no parameters within the A-trap, and were indexed from a 1024-entry, 4-kilobyte <link xlink:type="simple" xlink:href="../953/234953.xml">
dispatch table</link>.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%222%22])">2</ref> (Machines with 64 and 128 <link xlink:type="simple" xlink:href="../755/149755.xml">
KiB</link> ROMs had only 512 entry tables.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%223%22])">3</ref>)</p>

<ss1>
<st>
 On PowerPC systems </st>

<p>

In 1994, Apple released Macintoshes using the <link xlink:type="simple" xlink:href="../281/24281.xml">
PowerPC</link> architecture, which lacked hardware support for the A-trap mechanism. Because of their use in applying software patches, however, the dispatch tables were retained. The API library code underlying any Toolbox routine then does nothing except reference the dispatch table. The dispatch table linked only to emulated 68000 family code. Toolbox functions implemented in native PowerPC code have to first disable the emulator using the Mixed Mode Manager. For the sake of uniformity and extensibility, new function entries even continued to be added to the Toolbox after the PowerPC transition.</p>
<p>

An alternative mechanism did exist, however, in the Code Fragment Manager, which was used to load and dynamically link native PowerPC programs. The PowerPC system call facility, analogous to the A-trap mechanism, was used to interface with the <link xlink:type="simple" xlink:href="../643/12304643.xml">
Mac OS nanokernel</link>, which offered few services directly useful to applications.</p>

</ss1>
</sec>
<sec>
<st>
 Functionality </st>

<p>

The Toolbox is composed of commonly used functions, but not the <it>most</it> commonly used functions. As a result, it grew into a hodgepodge of different API <message wordnetid="106598915" confidence="0.8">
<information wordnetid="106634376" confidence="0.8">
<structure wordnetid="104341686" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<area wordnetid="102735688" confidence="0.8">
<library wordnetid="103660909" confidence="0.8">
<format wordnetid="106636806" confidence="0.8">
<room wordnetid="104105893" confidence="0.8">
<link xlink:type="simple" xlink:href="../421/106421.xml">
libraries</link></room>
</format>
</library>
</area>
</artifact>
</structure>
</information>
</message>
.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%223%22])">3</ref> The Toolbox encompasses most of the basic functionality which distinguished the Classic Mac OS. Apple's references <weblink xlink:type="simple" xlink:href="http://developer.apple.com/documentation/mac/Toolbox/Toolbox-2.html">
Inside Macintosh: Macintosh Toolbox Essentials</weblink> and <weblink xlink:type="simple" xlink:href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-2.html">
Inside Macintosh: More Macintosh Toolbox</weblink>, similarly vague in scope, also document most of the Toolbox.</p>

<ss1>
<st>
 As a <generic wordnetid="107899976" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../473/Form_4473.xml">
BIOS</link></generic>
 </st>

<p>

Because much of the Toolbox is implemented in ROM, alongside the computer's <link xlink:type="simple" xlink:href="../155/41155.xml">
firmware</link>, it was convenient to use as a <link xlink:type="simple" xlink:href="../909/40909.xml">
bootloader</link> environment. In conjunction with <link xlink:type="simple" xlink:href="../655/146655.xml">
resources</link> stored on the ROM chip, the Toolbox could turn the screen gray, show a dialog box with the signature "Welcome to Macintosh" greeting, and display the mouse cursor. The capability to interact with the user without loading an operating system is best known as a <link xlink:type="simple" xlink:href="../473/Form_4473.xml">
Basic Input/Output System</link>, although Toolbox facilities were not used to provide the interactive diagnostic utilities familiar in <link xlink:type="simple" xlink:href="../803/49803.xml">
IBM PC compatible</link>s. Indeed, in using the Toolbox to help boot the machine, a rudimentary Macintosh environment was initialized before loading the <link xlink:type="simple" xlink:href="../458/5144458.xml">
System suitcase</link> from disk.</p>
<p>

The similarity between the boot-up environment and the actual operating system should not be confused with being identical, however. Although the "Classic Mac OS" boot process is convoluted and largely undocumented, it is not more limited than a PC BIOS. Like a PC's <link xlink:type="simple" xlink:href="../389/55389.xml">
master boot record</link>, a ROM-based Mac reads and executes code from the first blocks ("boot blocks") of the <link xlink:type="simple" xlink:href="../380/55380.xml">
disk partition</link> selected as the <link>
boot device</link>. The boot blocks then verify that a suitable rudimentary environment exists, and use it to load the System suitcase. A different operating system with a different <link xlink:type="simple" xlink:href="../280/1010280.xml">
file system</link> can boot by simply using its own code in the boot blocks.<ref xlink:type="simple" xlink:href="#xpointer(//reflist/entry[@id=%224%22])">4</ref> This system was not used for PowerPC Linux, however, because <standard wordnetid="107260623" confidence="0.8">
<system_of_measurement wordnetid="113577171" confidence="0.8">
<link xlink:type="simple" xlink:href="../452/209452.xml">
Open Firmware</link></system_of_measurement>
</standard>
 in <link xlink:type="simple" xlink:href="../454/861454.xml">
New World ROM</link> machines requires a bootloader within an HFS filesystem—a reason having nothing to do with the Toolbox or "old-fashioned" Macs in general. More narrowly, the Startup Disk control panel in Mac OS and Mac OS X only allows the user to select a mounted filesystem with very particular constraints.</p>

</ss1>
</sec>
<sec>
<st>
 Legacy </st>

<p>

In <link xlink:type="simple" xlink:href="../640/20640.xml">
Mac OS X</link>, the Toolbox is not used at all, though the <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../892/56892.xml">
Classic environment</link></software>
 loads the Toolbox ROM file into its virtual machine. Much of the Toolbox was restructured and implemented as part of Apple's <link xlink:type="simple" xlink:href="../891/56891.xml">
Carbon</link> programming API, allowing programmers familiar with the Toolbox to <link xlink:type="simple" xlink:href="../804/214804.xml">
port</link> their program code more easily to Mac OS X.</p>

</sec>
<sec>
<st>
See also</st>
<p>

<list>
<entry level="1" type="bullet">

<link xlink:type="simple" xlink:href="../617/299617.xml">
Mac OS memory management</link></entry>
</list>
</p>

</sec>
<sec>
<st>
 References </st>
<p>

<reflist>
<entry id="1">
Apple Inc..&#32;"<weblink xlink:type="simple" xlink:href="http://developer.apple.com/documentation/mac/OSUtilities/OSUtilities-170.html#HEADING170-48">
A-Line Instructions</weblink>".</entry>
<entry id="2">
Apple Inc..&#32;"<weblink xlink:type="simple" xlink:href="http://developer.apple.com/documentation/mac/OSUtilities/OSUtilities-170.html">
About the Trap Manager</weblink>".</entry>
<entry id="3">
<weblink xlink:type="simple" xlink:href="http://www.mac.linux-m68k.org/devel/macalmanac.php">
Linux/m68k for Macintosh - Mac Alamanac II</weblink></entry>
<entry id="4">
Apple Inc..&#32;"<weblink xlink:type="simple" xlink:href="http://developer.apple.com/documentation/mac/OSUtilities/OSUtilities-189.html#HEADING189-31">
Boot Blocks</weblink>".</entry>
</reflist>
</p>

</sec>
<sec>
<st>
External links</st>
<p>

<list>
<entry level="1" type="bullet">

<weblink xlink:type="simple" xlink:href="http://developer.apple.com/documentation/mac/Toolbox/Toolbox-2.html">
Apple's <it>Inside Macintosh: Macintosh Toolbox Essentials</it> developer's guide</weblink></entry>
</list>
</p>

<p>

<table style=";" class="navbox" cellspacing="0">
<row>
<col style="padding:2px;">
<table style="width:100%;background:transparent;color:inherit;;" class="nowraplinks collapsible autocollapse " cellspacing="0">
<row>
<header colspan="2" style=";" class="navbox-title">
<link xlink:type="simple" xlink:href="../043/20043.xml">
Mac OS</link></header>
</row>
<row style="height:2px;">

</row>
<row>
<col style=";;" class="navbox-group">
Applications</col>
<col style="text-align:left;border-left:2px solid #fdfdfd;width:100%;padding:0px;;;" class="navbox-list navbox-odd">
<link>
Apple File Security</link>&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../249/3828249.xml">
Calculator</link></software>
&nbsp;·  <link xlink:type="simple" xlink:href="../710/842710.xml">
Chooser</link>&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../966/4221966.xml">
Drive Setup</link></software>
&nbsp;·  <physical_entity wordnetid="100001930" confidence="0.8">
<person wordnetid="100007846" confidence="0.8">
<player wordnetid="110439851" confidence="0.8">
<contestant wordnetid="109613191" confidence="0.8">
<causal_agent wordnetid="100007347" confidence="0.8">
<link xlink:type="simple" xlink:href="../945/3405945.xml">
DVD Player</link></causal_agent>
</contestant>
</player>
</person>
</physical_entity>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../166/156166.xml">
Finder</link></software>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../169/1098169.xml">
Graphing Calculator</link></software>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../978/3969978.xml">
Keychain Access</link></software>
&nbsp;·  <physical_entity wordnetid="100001930" confidence="0.8">
<person wordnetid="100007846" confidence="0.8">
<causal_agent wordnetid="100007347" confidence="0.8">
<spectator wordnetid="110633450" confidence="0.8">
<perceiver wordnetid="109626589" confidence="0.8">
<link xlink:type="simple" xlink:href="../191/2774191.xml">
PictureViewer</link></perceiver>
</spectator>
</causal_agent>
</person>
</physical_entity>
&nbsp;·  <link xlink:type="simple" xlink:href="../867/901867.xml">
PowerTalk</link>&nbsp;·  <link xlink:type="simple" xlink:href="../231/25231.xml">
QuickTime Player</link>&nbsp;·  <link xlink:type="simple" xlink:href="../180/2623180.xml">
Network Browser</link>&nbsp;·  <link xlink:type="simple" xlink:href="../803/6348803.xml">
Scrapbook</link>&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../710/342710.xml">
Sherlock</link></software>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../321/3049321.xml">
Software Update</link></software>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../613/696613.xml">
Stickies</link></software>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../083/3395083.xml">
Apple System Profiler</link></software>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../257/29257.xml">
SimpleText</link></software>
</col>
</row>
<row style="height:2px">

</row>
<row>
<col style=";;" class="navbox-group">
Developer</col>
<col style="text-align:left;border-left:2px solid #fdfdfd;width:100%;padding:0px;;;" class="navbox-list navbox-even">
<software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../698/435698.xml">
MacsBug</link></software>
&nbsp;·  <skilled_worker wordnetid="110605985" confidence="0.8">
<physical_entity wordnetid="100001930" confidence="0.8">
<communicator wordnetid="109610660" confidence="0.8">
<person wordnetid="100007846" confidence="0.8">
<editor wordnetid="110044879" confidence="0.8">
<worker wordnetid="109632518" confidence="0.8">
<compiler wordnetid="109946957" confidence="0.8">
<causal_agent wordnetid="100007347" confidence="0.8">
<writer wordnetid="110794014" confidence="0.8">
<link xlink:type="simple" xlink:href="../713/557713.xml">
Macintosh Programmer's Workshop</link></writer>
</causal_agent>
</compiler>
</worker>
</editor>
</person>
</communicator>
</physical_entity>
</skilled_worker>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../021/745021.xml">
ResEdit</link></software>
</col>
</row>
<row style="height:2px">

</row>
<row>
<col style=";;" class="navbox-group">
Technology</col>
<col style="text-align:left;border-left:2px solid #fdfdfd;width:100%;padding:0px;;;" class="navbox-list navbox-odd">
<link xlink:type="simple" xlink:href="../630/1243630.xml">
Command (⌘)</link>&nbsp;·  <artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<device wordnetid="103183080" confidence="0.8">
<key wordnetid="103613294" confidence="0.8">
<link xlink:type="simple" xlink:href="../528/1717528.xml">
Option (⌥)</link></key>
</device>
</instrumentality>
</artifact>
&nbsp;·  <link xlink:type="simple" xlink:href="../076/7379076.xml">
Apple menu</link>&nbsp;·  <link xlink:type="simple" xlink:href="../333/1479333.xml">
Balloon help</link>&nbsp;·  <link xlink:type="simple" xlink:href="../580/1628580.xml">
Bomb Error</link>&nbsp;·  <link>
Code Fragment Manager</link>&nbsp;·  <link xlink:type="simple" xlink:href="../077/2187077.xml">
Control Panel</link>&nbsp;·  <link xlink:type="simple" xlink:href="../362/11712362.xml">
Control Strip</link>&nbsp;·  <link xlink:type="simple" xlink:href="../973/147973.xml">
Creator code</link>&nbsp;·  <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../347/55347.xml">
Hierarchical File System</link></instrumentality>
</artifact>
</system>
&nbsp;·  <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../752/927752.xml">
HFS Plus</link></instrumentality>
</artifact>
</system>
&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../527/3049527.xml">
Keychain</link></software>
&nbsp;·  <link>
Apple Data Detectors</link>&nbsp;·  <link>
Apple Information Access Technology</link>&nbsp;·  <system wordnetid="104377057" confidence="0.8">
<artifact wordnetid="100021939" confidence="0.8">
<instrumentality wordnetid="103575240" confidence="0.8">
<link xlink:type="simple" xlink:href="../727/927727.xml">
Macintosh File System</link></instrumentality>
</artifact>
</system>
&nbsp;·  <link xlink:type="simple" xlink:href="../039/352039.xml">
PICT</link>&nbsp;·  <link xlink:type="simple" xlink:href="../439/256439.xml">
QuickDraw</link>&nbsp;·  <software wordnetid="106566077" confidence="0.9508927676800064">
<format wordnetid="106636806" confidence="0.9508927676800064">
<link xlink:type="simple" xlink:href="../231/25231.xml">
QuickTime</link></format>
</software>
&nbsp;·  <link xlink:type="simple" xlink:href="../655/146655.xml">
Resource fork</link>&nbsp;·  <link xlink:type="simple" xlink:href="../094/10773094.xml">
Special menu</link>&nbsp;·  <link xlink:type="simple" xlink:href="../805/2386805.xml">
System Folder</link>&nbsp;·  <link xlink:type="simple" xlink:href="../458/5144458.xml">
System suitcase</link>&nbsp;·  <link xlink:type="simple" xlink:href="../970/147970.xml">
Type code</link>&nbsp;·  <link xlink:type="simple" xlink:href="../333/1404333.xml">
WorldScript</link></col>
</row>
<row style="height:2px">

</row>
<row>
<col style=";;" class="navbox-group">
Related articles</col>
<col style="text-align:left;border-left:2px solid #fdfdfd;width:100%;padding:0px;;;" class="navbox-list navbox-even">
<link xlink:type="simple" xlink:href="../396/4517396.xml">
Manager</link>&nbsp;·  <link xlink:type="simple" xlink:href="../398/861398.xml">
Toolbox</link>&nbsp;·  <link xlink:type="simple" xlink:href="../617/299617.xml">
Memory Management</link>&nbsp;·  <link xlink:type="simple" xlink:href="../471/861471.xml">
Old World ROM</link>&nbsp;·  <link xlink:type="simple" xlink:href="../454/861454.xml">
New World ROM</link>&nbsp;·  <link xlink:type="simple" xlink:href="../065/866065.xml">
EFI</link></col>
</row>
</table>
</col>
</row>
</table>
</p>



</sec>
</bdy>
</article>
